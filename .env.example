# ==============================================================================
# YouTube Subtitle API - Environment Configuration
# ==============================================================================
# Copy this file to .env and fill in the values for your environment.
# NEVER commit .env files with actual secrets to version control.

# ==============================================================================
# SERVICE CONFIGURATION
# ==============================================================================
# Service name for logging and metrics
SERVICE_NAME=youtube-subtitles-api

# Environment: development, staging, production
ENVIRONMENT=production

# Log level: DEBUG, INFO, WARNING, ERROR, CRITICAL
LOG_LEVEL=INFO

# ==============================================================================
# API SERVER
# ==============================================================================
# Host address to bind to (0.0.0.0 for all interfaces)
API_HOST=0.0.0.0

# Port number for the API server
API_PORT=8010

# Number of Gunicorn worker processes (recommended: CPU cores * 2)
WORKERS=2

# Worker timeout in seconds
WORKER_TIMEOUT=30

# ==============================================================================
# DATABASE (PostgreSQL via Supabase)
# ==============================================================================
# Database connection URL (asyncpg driver required)
# Format: postgresql+asyncpg://postgres:PASSWORD@HOST:PORT/DATABASE
DATABASE_URL=postgresql+asyncpg://postgres:${DB_PASSWORD}@supabase-db:5432/postgres

# Database schema for isolation (recommended: youtube_subtitles)
DB_SCHEMA=youtube_subtitles

# Database connection pool size
DB_POOL_SIZE=10

# Database connection pool minimum size
DB_POOL_MIN_SIZE=2

# Database connection pool timeout in seconds
DB_POOL_TIMEOUT=30

# Enable SQL query logging (useful for debugging, disable in production)
DB_ECHO=false

# Auto-create tables on startup (prefer Alembic migrations in production)
DB_AUTO_CREATE=false

# ==============================================================================
# REDIS (Job Queue & Cache)
# ==============================================================================
# Redis connection URL (database 2 recommended for isolation)
REDIS_URL=redis://redis:6379/2

# Queue name for RQ job processing
REDIS_QUEUE_NAME=youtube-extraction

# Time-to-live for job results in Redis (86400 = 24 hours)
REDIS_RESULT_TTL=86400

# ==============================================================================
# YOUTUBE EXTRACTION
# ==============================================================================
# Maximum time to wait for YouTube API response (seconds)
YT_EXTRACTION_TIMEOUT=30

# Maximum retry attempts for failed extractions
YT_RETRY_MAX_ATTEMPTS=3

# Exponential backoff factor for retries (2 = double each time)
YT_RETRY_BACKOFF_FACTOR=2

# Optional: Comma-separated list of proxy URLs for fallback
# Example: http://proxy1.example.com:8080,http://proxy2.example.com:8080
YT_PROXY_URLS=

# Optional: Proxy authentication in user:pass format
YT_PROXY_AUTH=

# Cooldown period after proxy failures (seconds)
PROXY_COOLDOWN_SECONDS=60

# Maximum failures before rotating to next proxy
PROXY_MAX_FAILURES=3

# ==============================================================================
# RATE LIMITING
# ==============================================================================
# Requests per minute per IP address
RATE_LIMIT_REQUESTS_PER_MINUTE=30

# Burst capacity (additional requests allowed temporarily)
RATE_LIMIT_BURST_SIZE=5

# SECURITY: Fail open when Redis is unavailable (DANGEROUS)
# If false (default), denies requests when Redis is down (SECURE)
# If true, allows requests when Redis is down (DANGEROUS - dev only)
RATE_LIMIT_FAIL_OPEN=false

# Cache TTL in minutes (1440 = 24 hours)
CACHE_TTL_MINUTES=1440

# ==============================================================================
# SECURITY - AUTHENTICATION (REQUIRED FOR ADMIN ENDPOINTS)
# ==============================================================================
# You MUST configure at least one authentication method for admin endpoints.
# Admin endpoints will DENY ALL ACCESS if neither is configured (fail closed).

# API Key for X-API-Key header authentication
# Generate a strong key: openssl rand -base64 32
API_KEY=

# Alternative: JWT Secret for Bearer token authentication
# Generate a strong key: openssl rand -base64 32
JWT_SECRET=

# API Key Header Name (default: X-API-Key)
API_KEY_HEADER_NAME=X-API-Key

# ==============================================================================
# CORS CONFIGURATION
# ==============================================================================
# Comma-separated list of allowed origins. Empty list denies all (SECURE DEFAULT).
# IMPORTANT: You MUST configure this for your frontend to work.
#
# Examples:
#   ALLOWED_ORIGINS=https://example.com,https://www.example.com
#   ALLOWED_ORIGINS=http://localhost:3000,http://localhost:8080
#
# For DEVELOPMENT only, use "*" to allow all origins (DANGEROUS in production):
#   ALLOWED_ORIGINS=*
#
# Default (if not set): Empty list (denies all CORS requests)
ALLOWED_ORIGINS=

# ==============================================================================
# API VERSIONING
# ==============================================================================
# Current API version (v1, v2, etc.)
API_CURRENT_VERSION=v1

# Deprecated API versions (still supported but will redirect)
API_DEPRECATED_VERSIONS=

# Enable auto-redirect from /api/ to /api/v1/
API_DEPRECATED_PATH_REDIRECT=true

# ==============================================================================
# WEBHOOK CONFIGURATION
# ==============================================================================
# Secret key for HMAC signature generation on webhook payloads
# Required for webhook signature verification by receivers
# Generate: openssl rand -base64 32
WEBHOOK_SECRET=

# Webhook request timeout in seconds
WEBHOOK_TIMEOUT=10

# Maximum webhook delivery retry attempts
WEBHOOK_MAX_RETRIES=3

# ==============================================================================
# WORKER CONFIGURATION
# ==============================================================================
# Number of concurrent worker processes per container
WORKER_CONCURRENCY=2

# Job prefetch multiplier per worker
WORKER_PREFETCH_MULTIPLIER=1

# Database pool size per worker
WORKER_DB_POOL_SIZE=5

# ==============================================================================
# MONITORING & OBSERVABILITY
# ==============================================================================
# Enable Prometheus metrics endpoint (/metrics)
PROMETHEUS_ENABLED=true

# Optional: Sentry DSN for error tracking
# SENTRY_DSN=https://examplePublicKey@o0.ingest.sentry.io/123456
SENTRY_DSN=

# Enable profiling for performance analysis
ENABLE_PROFILING=false

# ==============================================================================
# IN-MEMORY CACHE
# ==============================================================================
# Maximum number of items in LRU cache
MEMORY_CACHE_MAX_SIZE=2000

# TTL for in-memory cache entries in seconds
MEMORY_CACHE_TTL_SECONDS=300

# ==============================================================================
# NGINX-PROXY (Optional)
# ==============================================================================
# Virtual host for nginx-proxy auto-discovery
VIRTUAL_HOST=

# Virtual port for nginx-proxy
VIRTUAL_PORT=8010

# Let's Encrypt host for SSL certificate
LETSENCRYPT_HOST=

# Let's Encrypt email for certificate expiration notices
LETSENCRYPT_EMAIL=
